<div>
<fieldset *ngIf="genes.length != 0" class="genes-table">
  <legend>
    {{legend}}
  </legend>

  <app-query-description-display *ngIf="description || descriptionParts.length != 0" class="description"
                                 [description]="description" [descriptionParts]="descriptionParts">
  </app-query-description-display>

  <div class="action-row">
    <div *ngIf="!showingVisualisation() && !showingSlim()">
      <div *ngIf="selectionInProgress()">
  <div class="action">
    <button class="btn btn-primary"
            [disabled]="selectedCount() == 0"
            title="{{selectedCount() == 0 ? 'Select some genes to filter' : 'Filter list to show only the selected genes'}}"
            (click)="filter()">Filter</button>
  </div>

  <div class="action">
    <button class="btn btn-primary"
            title="Cancel gene selection mode"
            (click)="cancelSelection()">Cancel</button>
  </div>

  <div class="action">
    Select: <a (click)="selectAll()">all</a> | <a (click)="selectNone()">none</a>
  </div>
  </div>

  <div *ngIf="!selectionInProgress()">
    <div class="action">
      <button class="btn btn-primary"
              (click)="configureColumns()"
              title="Add/remove columns">
        <fa-icon [icon]="faCog"></fa-icon> Columns ...
      </button>
    </div>

  <div class="action">
    <button class="btn btn-primary"
            title="Show gene visualisation"
            (click)="showVisualisation()">Visualise</button>
  </div>

  <div class="action" *ngFor="let subsetName of slimNames">
    <button class="btn btn-primary"
            title="Show gene slim"
            (click)="showSlim(subsetName)">Slim</button>
  </div>

  <div class="action">
      <button [disabled]="genes.length > 1000"
              title="{{genes.length > 1000 ? tooManyGenesTitle : selectGenesTitle}}"
              class="btn btn-primary" (click)="startSelection()">Select subset</button>
  </div>
  <div class="action">
    <button class="btn btn-primary" (click)="download()">Download ...</button>
  </div>

  </div>

  </div>

  <div *ngIf="showingVisualisation()" class="action">
    <button class="btn btn-primary"
            title="Return to gene list"
            (click)="showResults()">Finish visualisation</button>
  </div>

  <div *ngIf="showingSlim()" class="action">
    <button class="btn btn-primary"
            title="Return to gene list"
            (click)="showResults()">Back to results</button>
  </div>
  </div>

  <div class="content">
  <div *ngIf="showingVisualisation()">
    <app-gene-results-vis [genes]="genes">
    </app-gene-results-vis>
  </div>

  <div *ngIf="showingSlim()">
    <app-gene-results-slim-table [genes]="genes" [slimName]="slimName">
    </app-gene-results-slim-table>
  </div>

  <div *ngIf="!showingVisualisation() && !showingSlim()">
  <form>
  <table>
    <thead>
      <tr>
        <th *ngIf="selectionInProgress()">
          &nbsp;
        </th>
        <th *ngFor="let fieldConfig of visibleFields">
          <div *ngIf="sortableField(fieldConfig.name)">
            <a *ngIf="orderByFieldName != fieldConfig.name" (click)="setOrderBy(fieldConfig.name)"
               title="Click to sort">{{fieldConfig.display_name}}</a>
            <span *ngIf="orderByFieldName == fieldConfig.name">{{fieldConfig.display_name}}</span>
          </div>
          <div *ngIf="!sortableField(fieldConfig.name)">
            {{fieldConfig.display_name}}
          </div>
        </th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let gene of displayGenes | geneShortOrderBy: orderByFieldName">
        <td *ngIf="selectionInProgress()">
          <input id="show-translation" type="checkbox"
                 [name]="gene.uniquename"
                 (ngModelChange)="selectionChanged()"
                 [(ngModel)]="selectedGenes[gene.uniquename]"/>
        </td>
        <td *ngFor="let fieldName of visibleFieldNames">
          <div *ngIf="fieldName == 'uniquename'">
            <a routerLink="/gene/{{gene['uniquename']}}">
              {{gene['uniquename']}}
            </a>
          </div>
          <div *ngIf="fieldName == 'name'">
            <a *ngIf="gene.name" routerLink="/gene/{{gene['name']}}">
              {{gene['name']}}
            </a>
          </div>
          <div *ngIf="fieldName == 'product'">
            <ng-container *ngIf="gene['product']">
              {{gene['product']}}
            </ng-container>
          </div>
          <div *ngIf="!sortableField(fieldName)">
            <span [innerHtml]="displayFieldValue(gene, fieldName)"></span>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
  </form>
  </div>
</div>
</fieldset>

</div>
