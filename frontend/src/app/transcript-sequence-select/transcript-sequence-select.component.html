<fieldset class="annotation-table transcript-sequence-select">
  <legend>
    Sequence
  </legend>
  <div>
    <div *ngIf="hasTranscripts">
        <div class="controls">
          <div *ngIf="featureIsTranslatable">
          <input id="show-translation" type="checkbox" [(ngModel)]="showTranslation"
                 (ngModelChange)="updateSequence()"/>
          <label for="show-translation">Show translation</label>
          </div>

          <div *ngIf="!showTranslation">
            <div *ngIf="featureIsTranslatable" class="seq-title">
              CDS sequence and:
            </div>
            <div *ngIf="!featureIsTranslatable" class="seq-title">
              Gene sequence:
            </div>

            <div class="checkbox-section" *ngIf="featureIsTranslatable">
            <div *ngIf="has5PrimeUtr">
            <input id="include-5-prime" type="checkbox" [(ngModel)]="include5PrimeUtr"
                   (ngModelChange)="updateSequence()"/>
            <label for="include-5-prime">Include 5'UTR</label>
            </div>
            <div class="flanking-bases">
              Include
              <input id="upstream-bases" type="number" min="0"
                     [(ngModel)]="upstreamBases" (ngModelChange)="updateSequence()"/>
              bases upstream <span *ngIf="featureIsTranslatable && include5PrimeUtr">of UTR</span>
            </div>
            </div>

            <div class="checkbox-section" *ngIf="cdsIntronCount > 0 || fivePrimeIntronCount > 0 || threePrimeIntronCount > 0">
            <input id="include-introns" type="checkbox" [(ngModel)]="includeIntrons"
                   (ngModelChange)="updateSequence()"/>
            <label for="include-introns">Include introns</label>
            <div class="utr-intron-warning" *ngIf="includeIntrons && (include5PrimeUtr && fivePrimeIntronCount > 0 || include3PrimeUtr && threePrimeIntronCount > 0)">
              <div *ngIf="include5PrimeUtr">
                <div *ngIf="fivePrimeIntronCount == 1">(Includes one 5'UTR intron)</div>
                <div *ngIf="fivePrimeIntronCount > 1">(Includes {{fivePrimeIntronCount}} introns in the 5'UTR)</div>
              </div>
              <div *ngIf="include3PrimeUtr">
                <div *ngIf="threePrimeIntronCount == 1">(Includes one 3'UTR intron)</div>
                <div *ngIf="threePrimeIntronCount > 1">(Includes {{threePrimeIntronCount}} introns in the 3'UTR)</div>
              </div>
            </div>
            </div>

            <div class="checkbox-section" *ngIf="featureIsTranslatable">
            <div *ngIf="has3PrimeUtr">
            <input id="include-3-prime" type="checkbox" [(ngModel)]="include3PrimeUtr"
                   (ngModelChange)="updateSequence()"/>
            <label for="include-3-prime">Include 3'UTR</label>
            </div>
            <div class="flanking-bases">
              Include
              <input id="downstream-bases" type="number" min="0"
                     [(ngModel)]="downstreamBases" (ngModelChange)="updateSequence()"/>
              bases downstream <span *ngIf="featureIsTranslatable && include3PrimeUtr">of UTR</span>
            </div>
            </div>
          </div>

          <div class="sequence-actions">
            <span class="sequence-action">
          <button class="btn btn-primary" (click)="download()">Download sequence</button>
            </span>

            <span class="sequence-action">
          <form id="ncbi-blast-gene" name="NCBIBLAST" #ncbiform
                action="https://blast.ncbi.nlm.nih.gov/Blast.cgi" method="POST">
            <input name="QUERY" value="{{'>' + sequenceHeader + '\n' + sequence}}" type="hidden">
            <input name="PROGRAM" value="{{showTranslation?'blastp':'blastn'}}" type="hidden">
            <input name="PAGE_TYPE" value="BlastSearch" type="hidden">
            <button class="btn btn-primary" type="submit" (click)="ncbiform.submit()">NCBI {{showTranslation?'BLASTP':'BLASTN'}}</button>
          </form>
            </span>

            <span class="sequence-action">
          <form id="ens-blast-gene" name="BLASTGenomicSequence" #ensform
                action="http://fungi.ensembl.org/Multi/Tools/Blast{{showTranslation?'?query=peptide;database=peptide':''}}" method="POST">
            <input value="{{'>' + sequenceHeader + '\n' + sequence}}" name="query_sequence" type="hidden">
            <button class="btn btn-primary" type="submit" (click)="ensform.submit()">Ensembl {{showTranslation ? 'Protein' : 'DNA'}} BLAST</button>
          </form>
            </span>
          </div>
        </div>
        <div class="sequence">
          <pre *ngIf="sequence">
&gt;{{sequenceHeader}}
{{sequence}}
          </pre>
          <div *ngIf="sequence != null && sequence == ''">
            (No sequence selected)
          </div>
          <app-loading-spinner *ngIf="sequence == null"></app-loading-spinner>
        </div>
    </div>
    <div *ngIf="!hasTranscripts">
      This gene has no transcripts available
    </div>
  </div>
</fieldset>
