<fieldset class="annotation-table transcript-sequence-select">
  <legend>
    Sequence
  </legend>
  <div>
    <div *ngIf="hasTranscripts">
        <div class="controls">
          <div *ngIf="featureIsTranslatable">
          <input id="show-translation" type="checkbox" [(ngModel)]="showTranslation"
                 (ngModelChange)="updateSequence()"/>
          <label for="show-translation">Show translation</label>
          </div>

          <div *ngIf="!showTranslation">
            <div class="seq-title">
              Display sequence of these gene parts:
            </div>

            <div class="flanking-bases">
              <input id="upstream-bases" type="number" min="0"
                     [(ngModel)]="upstreamBases" (ngModelChange)="updateSequence()"/>
              bases upstream
              <span *ngIf="featureIsTranslatable && include5PrimeUtr">of UTR</span>
              <span *ngIf="!(featureIsTranslatable && include5PrimeUtr)">
                <span *ngIf="featureIsTranslatable">of translation start</span>
                <span *ngIf="!featureIsTranslatable">of gene start</span>
              </span>
            </div>
            <div class="checkbox-section" *ngIf="featureIsTranslatable">
            <div *ngIf="has5PrimeUtr">
            <input id="include-5-prime" type="checkbox" [(ngModel)]="include5PrimeUtr"
                   (ngModelChange)="updateSequence()"/>
            <label for="include-5-prime">5'UTR</label>
            </div>
            <div *ngIf="!has5PrimeUtr">
              (no 5' UTR)
            </div>
            </div>

            <div class="checkbox-section">
              <input id="include-exons" type="checkbox" [(ngModel)]="includeExons"
                     (ngModelChange)="updateSequence()"/>
              <label for="include-exons">Exons</label>
            </div>

            <div class="checkbox-section" *ngIf="cdsIntronCount > 0 || fivePrimeIntronCount > 0 || threePrimeIntronCount > 0">
            <input id="include-introns" type="checkbox" [(ngModel)]="includeIntrons"
                   (ngModelChange)="updateSequence()"/>
            <label for="include-introns">Introns</label>
            <div class="utr-intron-warning" *ngIf="includeIntrons && (include5PrimeUtr && fivePrimeIntronCount > 0 || include3PrimeUtr && threePrimeIntronCount > 0)">
              <div *ngIf="include5PrimeUtr">
                <div *ngIf="fivePrimeIntronCount == 1">(Includes one 5'UTR intron)</div>
                <div *ngIf="fivePrimeIntronCount > 1">(Includes {{fivePrimeIntronCount}} introns in the 5'UTR)</div>
              </div>
              <div *ngIf="include3PrimeUtr">
                <div *ngIf="threePrimeIntronCount == 1">(Includes one 3'UTR intron)</div>
                <div *ngIf="threePrimeIntronCount > 1">(Includes {{threePrimeIntronCount}} introns in the 3'UTR)</div>
              </div>
            </div>
            </div>

            <div class="checkbox-section" *ngIf="featureIsTranslatable">
            <div *ngIf="has3PrimeUtr">
            <input id="include-3-prime" type="checkbox" [(ngModel)]="include3PrimeUtr"
                   (ngModelChange)="updateSequence()"/>
            <label for="include-3-prime">3'UTR</label>
            </div>
            <div *ngIf="!has3PrimeUtr">
              (no 3' UTR)
            </div>
            </div>
            <div class="flanking-bases">
              <input id="downstream-bases" type="number" min="0"
                     [(ngModel)]="downstreamBases" (ngModelChange)="updateSequence()"/>
              bases downstream
              <span *ngIf="featureIsTranslatable && include3PrimeUtr">of UTR</span>
              <span *ngIf="!(featureIsTranslatable && include3PrimeUtr)">
                <span *ngIf="featureIsTranslatable">of translation end</span>
                <span *ngIf="!featureIsTranslatable">of gene end</span>
              </span>
            </div>
          </div>

          <div *ngIf="wrappedSequence" class="sequence-actions">
            <div style="vertical-align: top;" class="sequence-action">
              <button class="btn btn-primary" (click)="download()">Download sequence</button>
            </div>

            <div style="display: inline-block" class="sequence-action">
              <span class="sequence-action">
                <form id="ncbi-blast-gene" name="NCBIBLAST" #ncbidnaform
                      (ngSubmit)="ncbidnaform.submit()"
                      target="_blank"
                      action="https://blast.ncbi.nlm.nih.gov/Blast.cgi" method="GET">
                  <input name="QUERY" value="{{'>' + sequenceHeader + '\n' + wrappedSequence}}" type="hidden">
                  <input name="PROGRAM" value="blastn" type="hidden">
                  <input name="PAGE_TYPE" value="BlastSearch" type="hidden">
                  <input class="btn btn-primary" type="submit" value="NCBI BLASTN" />
                </form>
              </span>

              <span class="sequence-action">
                <form id="ens-blast-gene" name="BLASTGenomicSequence" #ensdnaform
                      (ngSubmit)="ensdnaform.submit();"
                      target="_blank"
                      action="https://fungi.ensembl.org/Schizosaccharomyces_pombe/Tools/Blast" method="POST">
                  <input value="{{'>' + sequenceHeader + '\n' + wrappedSequence}}" name="query_sequence" type="hidden">
                  <input class="btn btn-primary" type="submit" value="Ensembl DNA BLAST" />
                </form>
              </span>

              <span class="sequence-action">
                <form id="ncbi-blast-gene" name="NCBIBLAST" #ncbiprotform
                      (ngSubmit)="ncbiprotform.submit()"
                      target="_blank"
                      action="https://blast.ncbi.nlm.nih.gov/Blast.cgi" method="GET">
                  <input name="QUERY" value="{{'>' + proteinSequenceHeader + '\n' + wrappedProteinSequence}}" type="hidden">
                  <input name="PROGRAM" value="blastp" type="hidden">
                  <input name="PAGE_TYPE" value="BlastSearch" type="hidden">
                  <input class="btn btn-primary" type="submit" value="NCBI BLASTP" />
                </form>
              </span>

              <span class="sequence-action">
                <form id="ens-blast-gene" name="BLASTGenomicSequence" #ensprotform
                      (ngSubmit)="ensprotform.submit();"
                      target="_blank"
                      action="https://fungi.ensembl.org/Schizosaccharomyces_pombe/Tools/Blast?query=peptide;database=peptide" method="POST">
                  <input value="{{'>' + proteinSequenceHeader + '\n' + wrappedProteinSequence}}" name="query_sequence" type="hidden">
                  <input class="btn btn-primary" type="submit" value="Ensembl Protein BLAST" />
                </form>
              </span>
            </div>
          </div>
        </div>

        <div class="sequence-holder">
          <pre *ngIf="showTranslation">
&gt;{{proteinSequenceHeader}}
{{wrappedProteinSequence}}
          </pre>

          <div class="sequence-display" *ngIf="!showTranslation">
          <div *ngIf="wrappedSequence">
          <div class="header">
&gt;{{sequenceHeader}}
          </div>
          <div class="residues">
          <div class="residue-line" *ngFor="let line of displaySequence.getLines()">
            <span title="{{partTitle(part)}}" class="{{partClass(part)}}"
                 (mouseenter)="mouseenter(part)" (mouseleave)="mouseleave()"
                  *ngFor="let part of line.getParts()">{{part.residues}}</span>
          </div>
          </div>
          </div>
          <div *ngIf="!wrappedSequence">
            (No sequence to display)
          </div>
          <app-loading-spinner *ngIf="wrappedSequence == null"></app-loading-spinner>
          </div>
        </div>
    </div>
    <div *ngIf="!hasTranscripts">
      This gene has no transcripts available
    </div>
  </div>
</fieldset>
