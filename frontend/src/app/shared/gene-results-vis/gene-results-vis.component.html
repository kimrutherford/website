<div class="vis-main">
  <div class="vis-column-select">
    <div *ngFor="let colConfig of visColumnConfigs">
      {{colConfig.display_name}}:
      <input type="checkbox"
             (change)="confSelectionChanged()"
             [(ngModel)]="activeColumns[colConfig.name]"/>
      <a *ngIf="showResults() && activeColumns[colConfig.name]"
         (click)="setSortBy(colConfig.name)">[sort]</a>
    </div>

    <div class="svg-download" *ngIf="showResults()">
      <a (click)="saveAsSVG()">Download image as SVG ...</a>
    </div>
  </div>

  <ng-template #genePopover>
    <div *ngIf="currentGene">
    <div class="gene-name-and-product">
      <span class="gene-name">{{currentGene.getGeneShort().name}}</span> {{currentGene.getGeneShort().uniquename}}
      <span *ngIf="currentGene.getGeneShort().product">
        {{currentGene.getGeneShort().product}}
      </span>
    </div>
    <div *ngFor="let colConfig of visColumnConfigs">
      {{colConfig.display_name}}: {{currentGene.getField(colConfig.name)}}
    </div>
    </div>
  </ng-template>
  <ng-template #colPopover>
    <div *ngIf="currentData">
    <div>
      {{currentData.columnConfig.display_name}}: {{currentData.displayName}}
    </div>
    <div class="pop-up-help">
      (click to toggle selection)
    </div>
    </div>
  </ng-template>
  <div class="vis-results">
    <div *ngIf="!showResults()">
      (Select a column type from the list to the left)
    </div>

    <div *ngIf="showResults()">
        <svg #visSVG [attr.width]="geneWidth + activeConfigNames.length * (columnWidth + columnGap) + 100"
             [attr.height]="colLabelHeight + genes.length * lineHeight + 10"
             xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"
             id="gene-vis" overflow="visible">
          <svg:defs>
            <style type="text/css">
               rect.vis-gene {
                 fill: #f0f0f0;
               }
               rect.vis-gene:nth-child(10n) {
                 fill: #e0e0e0;
               }
            </style>
          </svg:defs>
          <svg:g style="pointer-events: all">
            <svg:rect *ngFor="let geneData of getGeneDisplayData()"
                      class="vis-gene"
                  (click)="geneclick($event)"
                  (mouseenter)="geneEnter($event, geneData)"
                  (mouseleave)="geneLeave($event, geneData)"
                  [ngClass]="{'vis-gene-selected': selectedGenes[geneData.geneUniquename]}"
                  [attr.id]="geneData.id" [attr.height]="lineHeight"
                  [attr.width]="geneWidth + activeConfigNames.length * (columnWidth + columnGap)"
                  [attr.x]="0"
                  [attr.y]="5 + colLabelHeight + geneData.geneIndex * lineHeight"
                  stroke-width="0" stroke="#9f9"
                  [popover]="genePopover"
                  triggers="mouseenter:mouseleave"
                  placement="right"
                  container="body"
                  style="pointer-events: inherit;">
            </svg:rect>
          </svg:g>
          <svg:g *ngFor="let columnName of activeConfigNames; let columnIndex = index">
            <svg:text class="col-label"
                      attr.transform="translate({{colLabelXOffset + geneWidth + columnIndex * (columnWidth + columnGap) + columnGap}} {{colLabelHeight}}) rotate(-60)">
              {{visColumnConfigMap[columnName].display_name}}
            </svg:text>
            <svg:rect *ngFor="let columnData of getColumnDisplayDataMap()[columnName]"
                  class="vis-column"
                  (click)="dataClick($event, columnData)"
                  (mouseenter)="dataEnter($event, columnData)"
                  (mouseleave)="dataLeave($event, columnData)"
                  [attr.height]="lineHeight * (columnData.endIndex - columnData.startIndex + 1)"
                  [attr.width]="columnWidth"
                  [attr.x]="geneWidth + columnIndex * (columnWidth + columnGap) + columnGap"
                  [attr.y]="5 + colLabelHeight + lineHeight * columnData.startIndex"
                  [attr.fill]="columnData.color"
                  [popover]="colPopover"
                  triggers="mouseenter:mouseleave"
                  placement="top"
                  container="body"
                  style="pointer-events: fill;">
            </svg:rect>
          </svg:g>
        </svg>
    </div>
  </div>

  <div class="vis-selected-genes" *ngIf="selectedGeneList.length != 0">
    <div>
      <span *ngIf="selectedGeneList.length == 1" class="vis-selected-genes-heading">
      One selected gene
      </span>
      <span *ngIf="selectedGeneList.length > 1" class="vis-selected-genes-heading">
      {{selectedGeneList.length}} selected genes
      </span>
      <span><a (click)="clearSelected()"> [clear]</a></span>
    </div>
    <div class="vis-selected-genes-list">
    <div class="vis-selected-genes-gene"
         *ngFor="let geneData of selectedGeneList.slice(0, geneListMaxLength)">
      <app-gene-link [gene]="geneData.getGeneShort()" [long]="false">
      </app-gene-link>
    </div>
    </div>
    <div *ngIf="selectedGeneList.length > geneListMaxLength">
      (and {{selectedGeneList.length - geneListMaxLength}} others)
    </div>
    <button class="btn btn-primary"
    title="Send selected genes to the advanced search page"
    (click)="sendToQueryBuilder()">Filter</button>
  </div>
</div>
