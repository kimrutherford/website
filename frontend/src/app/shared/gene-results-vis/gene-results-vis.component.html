<div class="vis-main">
  <div class="vis-column-select">
    <div *ngFor="let colConfig of visColumnConfigs">
      {{colConfig.display_name}}:
      <input type="checkbox"
             (change)="confSelectionChanged()"
             [(ngModel)]="activeColumns[colConfig.name]"/>
      <a *ngIf="showResults()" (click)="setSortBy(colConfig.name)">[sort]</a>
    </div>
    <div *ngIf="showResults()">
      <a (click)="setSortBy('gene-name')">[Sort by gene name]</a>
    </div>

    <div class="feature-size" *ngIf="showResults()">
      Feature size: <a *ngIf="lineHeight > 1" (click)="changeLineHeight(-1)">[-]</a>
      <span style="color: #bbb" *ngIf="lineHeight <= 1">[-]</span>
      <a (click)="changeLineHeight(1)">[+]</a>
    </div>
  </div>

  <div class="vis-results">
    <div *ngIf="!showResults()">
      (Select a column type from the list to the left)
    </div>

    <div *ngIf="showResults()">
      <div class="vis-svg">
        <svg [attr.width]="geneWidth + activeConfigNames.length * (columnWidth + columnGap) + 20"
             [attr.height]="genes.length * lineHeight + 10"
             xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"
             id="gene-vis" overflow="visible">
          <g style="pointer-events: all">
            <rect *ngFor="let geneData of getGeneDisplayData()"
                  (click)="geneclick($event)"
                  (mouseenter)="geneEnter($event, geneData)"
                  (mouseleave)="geneLeave($event, geneData)"
                  [ngClass]="{'vis-gene': !selectedGenes[geneData.geneUniquename], 'vis-gene-selected': selectedGenes[geneData.geneUniquename]}"
                  [attr.id]="geneData.id" [attr.height]="lineHeight"
                  [attr.width]="geneWidth + activeConfigNames.length * (columnWidth + columnGap)"
                  [attr.x]="0"
                  [attr.y]="geneData.geneIndex * lineHeight"
                  stroke-width="0" stroke="#9f9"
                  style="pointer-events:inherit">
            </rect>
          </g>
          <g *ngFor="let columnName of activeConfigNames; let columnIndex = index">
            <rect *ngFor="let columnData of getColumnDisplayDataMap()[columnName]"
                  class="vis-column"
                  (click)="dataClick($event, columnData)"
                  [attr.height]="lineHeight * (columnData.endIndex - columnData.startIndex + 1)"
                  [attr.width]="columnWidth"
                  [attr.x]="geneWidth + columnIndex * (columnWidth + columnGap) + columnGap"
                  [attr.y]="lineHeight * columnData.startIndex"
                  stroke-width="0" stroke="#9f9"
                  [attr.fill]="columnData.color" fill-opacity="0.7"
                  style="pointer-events:inherit">
            </rect>
          </g>
        </svg>
      </div>
    </div>
  </div>

  <div class="vis-gene-details" *ngIf="currentGene">
    <div>
      <span class="gene-name">{{currentGene.getGeneShort().name}}</span> {{currentGene.getGeneShort().uniquename}}
      <span *ngIf="currentGene.getGeneShort().product">
        {{currentGene.getGeneShort().product}}
      </span>
    </div>
    <div *ngFor="let colConfig of visColumnConfigs">
      {{colConfig.display_name}}: {{currentGene.getField(colConfig.name)}}
    </div>
  </div>

  <div class="vis-selected-genes" *ngIf="selectedGeneList.length != 0">
    <div *ngIf="selectedGeneList.length == 1" class="vis-selected-genes-heading">
      One selected gene:
    </div>
    <div *ngIf="selectedGeneList.length > 1" class="vis-selected-genes-heading">
      {{selectedGeneList.length}} selected genes:
    </div>
    <div class="vis-selected-genes-gene"
         *ngFor="let geneData of selectedGeneList.slice(0, 30)">
      {{geneData.getGeneShort().name || geneData.getGeneShort().uniquename}}
    </div>
    <div *ngIf="selectedGeneList.length > 30">
      (and {{selectedGeneList.length - 30}} others)
    </div>
    <button class="btn btn-primary"
    title="Send selected genes to the advanced search page"
    (click)="sendToQueryBuilder()">Filter</button>
  </div>
</div>
